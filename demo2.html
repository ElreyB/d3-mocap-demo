<html>
    <head>
        <title>
            Visualizing Motion Capture Data with D3.js
        </title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    
        <style>

        </style>
    </head>
    <body>
        <div id="head">
            Mocap Demo #2 - Sketching
        </div>
        <div id="c1">
            
        </div>
        <div style="height: 10px"></div>
        <div id="c2">
            
        </div>
        <div style="height: 10px"></div>
        <div id="c3" style="margin-left: 20px;">
            
        </div>

        <div id="c4" style="margin-left: 20px;">
            
        </div>

        <script>
            function draw() {
            // Prep the environment 
            var parent = d3.select("body").select("#c1");

            var svg = parent.append("svg")
                .attr("width", w)
                .attr("height", h)
                .attr("overflow", "scroll")
                .style("display", "inline-block");

            // Scale the data
            index = 30;
            frames = positions.map(function(ff, j) {

                return ff.map(function(d, i) {
                return {
                    x: (d.x + 100) * figureScale,
                    y: -1 * d.y * figureScale + h - 50,
                    z: d.z * figureScale
                };
                });

            });

            currentFrame = frames[index];
            // Joints
            headJoint = 15;

            svg.selectAll("g")
                .data(frames)
                .enter()
                .append("g")
                .attr("transform",function(d,i) {
                            return "translate("+(i*40)+",0)";
                })
                .selectAll("circle.f" + index)
                .data(function(d,i) {return d})
                .enter()
                .append("circle")
                .attr("cx", function(d) {
                return d.x;
                }).attr("cy", function(d) {
                return d.y;
                }).attr("r", function(d, i) {
                if (i == headJoint)
                    return 4;
                else
                    return 2;
                }).attr("fill", function(d, i) {
                return '#555555';
                });


            // Bones
            svg.selectAll("g2")
                .data(frames)
                .enter()
                .append("g")
                .attr("transform",function(d,i) {
                            return "translate("+(i*40)+",0)";
                })
                .selectAll("line.f" + index)
                .data(connectivityMatrix)
                .enter()
                .append("line")
                .attr("stroke", "grey")
                .attr("stroke-width", 1)
                .attr("x1", 0).attr("x2", 0)
                .attr("x1", function(d, j, k) {
                return frames[k][d[0]].x;
                })
                .attr("x2", function(d, j, k) {
                return frames[k][d[1]].x;
                })
                .attr("y1", function(d, j, k) {
                return frames[k][d[0]].y;
                })
                .attr("y2", function(d, j, k) {
                return frames[k][d[1]].y;
                });
            }


            // Variables
            var connectivityMatrix;
            var positions;
            var figureScale = 2;
            var h = 200;
            var w = 10000;

            // Read the files
            $.getJSON("http://omid.al/d3-mocap-demo/ConnectivityMatrix.json", function(json) {
            connectivityMatrix = json;
            $.getJSON("http://omid.al/d3-mocap-demo/Slash.json", function(json) {
                positions = json;
                draw();
            });
            });

        </script>
    </body>
</html>