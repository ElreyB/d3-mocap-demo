<html>
    <head>
        <title>
            Visualizing Motion Capture Data with D3.js
        </title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    
        <style>

        </style>
    </head>
    <body>
        <div id="head">
            Mocap Demo
        </div>
        <div id="c1">
            
        </div>
        <div style="height: 10px"></div>
        <div id="c2">
            
        </div>
        <div style="height: 10px"></div>
        <div id="c3" style="margin-left: 20px;">
            
        </div>

        <div id="c4" style="margin-left: 20px;">
            
        </div>

        <script>

            // Variables
            var connectivityMatrix;
            var positions;   
            var figureScale = 2;         
            var h = 200;
            var w = 400;

            // Read the files
            $.getJSON("ConnectivityMatrix.json", function(json) {
                connectivityMatrix = json;
                $.getJSON("Slash.json", function(json) {
                    positions = json;
                    draw();
                });
            });

            


            function draw() {
                // Prep the environment 
                var parent = d3.select("body").select("#c1");

                var svg = parent.append("svg")
                    .attr("width", w)
                    .attr("height", h)
                    .attr("overflow","scroll")
                    .style("display","inline-block");
                
                // Scale the data
                index = 0;
                currentFrame = positions[index].map(function(d,i) {            
                    return {
                        x : (d.x + 40) * figureScale,
                        y : -1 * d.y * figureScale + h - 50,
                        z : d.z * figureScale
                    };
                });


                // Joints
                headJoint = 15;

                svg.selectAll("circle.f" + index)
                .data(currentFrame)
                .enter()
                .append("circle")
                .attr("cx", function(d) {
                    return d.x;
                }).attr("cy", function(d) {
                    return d.y;
                }).attr("r", function(d, i) {
                    if (i == headJoint )
                        return 4;
                    else
                        return 2;
                }).attr("fill", function(d, i) {
                    return '#555555';
                });


                // Bones

                 svg.selectAll("line.f" + index)
                    .data(connectivityMatrix)
                    .enter()
                    .append("line")
                    .attr("stroke", "grey")
                    .attr("stroke-width",1)
                    .attr("x1",0).attr("x2",0)
                    .attr("x1", function(d, j) {
                        return currentFrame[d[0]].x;
                    })
                    .attr("x2", function(d, j) {
                        return currentFrame[d[1]].x;
                    })
                    .attr("y1", function(d, j) {
                        return currentFrame[d[0]].y;
                    })
                    .attr("y2", function(d, j) {
                        return currentFrame[d[1]].y;
                    });
            }

        </script>
    </body>
</html>